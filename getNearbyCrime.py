from pymongo import MongoClient
import os
from dotenv import load_dotenv
load_dotenv()
username = os.getenv("DB_USERNAME")
password = os.getenv("DB_PASSWORD")

cluster = MongoClient(f"mongodb+srv://{username}:{password}@hackunited.ajckk.mongodb.net/?retryWrites=true&w=majority&appName=HackUnited")
db=cluster["GeoGuard"]
collection = db["Crime"]

def getNearbyCrime(route):
    bigData = []
    for point in route:
        nearby_locations = collection.find({
            "location": {
                "$near": {
                    "$geometry": {
                        "type": "Point",
                        "coordinates": point[::-1]
                    },
                    "$maxDistance": 50  # 200 meters
                }
            }
        })
        bigData.append([point[::-1], nearby_locations])
    return bigData

print(getNearbyCrime([[43.65438, -79.38009], [43.65477, -79.38025], [43.65475, -79.38037], [43.65594, -79.38088], [43.65622, -79.381], [43.65631, -79.38104], [43.65638, -79.38107], [43.65634, -79.38131], [43.65609, -79.38239], [43.65588, -79.3834], [43.65587, -79.38353], [43.65585, -79.38363], [43.65582, -79.38377], [43.65579, -79.3839], [43.65552, -79.38516], [43.6555, -79.38523], [43.65549, -79.38529], [43.65535, -79.38593], [43.65533, -79.38604], [43.6553, -79.38616], [43.65511, -79.38705], [43.65509, -79.38716], [43.65507, -79.38725], [43.65491, -79.3879], [43.65492, -79.38806], [43.65493, -79.3882], [43.65494, -79.38831], [43.65494, -79.38838], [43.65494, -79.38844], [43.65492, -79.38852], [43.65489, -79.38865], [43.65502, -79.3887], [43.65619, -79.38919], [43.65622, -79.38921], [43.65628, -79.38923], [43.65636, -79.38926], [43.65638, -79.38927], [43.65633, -79.38936], [43.65629, -79.38961], [43.65631, -79.3899], [43.65625, -79.39035], [43.65701, -79.39071], [43.65798, -79.39116], [43.65832, -79.39131], [43.65836, -79.3913], [43.65834, -79.39138], [43.65842, -79.39141], [43.65845, -79.39143], [43.65812, -79.39294], [43.65811, -79.39304], [43.65809, -79.39313], [43.65845, -79.39328], [43.65872, -79.39339], [43.65909, -79.39356], [43.65918, -79.3936], [43.65927, -79.39364], [43.6592, -79.39401], [43.65927, -79.39405], [43.65928, -79.39409], [43.65934, -79.39411], [43.65963, -79.39423], [43.6602, -79.39446], [43.66027, -79.39449], [43.66025, -79.39455], [43.66064, -79.39471], [43.66075, -79.39477], [43.66077, -79.39484], [43.66076, -79.3949], [43.6608, -79.39492], [43.66094, -79.39519], [43.66101, -79.39535], [43.66103, -79.39554], [43.66099, -79.39583], [43.66102, -79.39595], [43.66115, -79.396], [43.66143, -79.39612], [43.66166, -79.39622], [43.66186, -79.39631], [43.66226, -79.39649], [43.66207, -79.39749], [43.66205, -79.39759], [43.66203, -79.39768], [43.66206, -79.39769], [43.66215, -79.39773], [43.66207, -79.39806], [43.66195, -79.39868], [43.6619, -79.39891], [43.66198, -79.3992], [43.66203, -79.39938], [43.66243, -79.39954], [43.6627, -79.39965], [43.66321, -79.39986], [43.66343, -79.39994], [43.66342, -79.40001], [43.6635, -79.40004], [43.66357, -79.40007], [43.66429, -79.40036], [43.66491, -79.40061]]))